<!DOCTYPE html>


<head>

    <meta charset="utf-8">
    <title>Comorbidity in the World Health Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Comorbidity in the World Health Survey">
    <meta name="keywords" content="Mental, Disorders, Schizophrenia">
    <meta name="author" content="Yan Holtz et al.">

    <!-- Control appearance when share by social media -->
    <meta property="og:title" content="Comorbidity in the World Health Survey" />
    <meta property="og:image" content="img/TODO" />
    <meta property="og:description" content="Comorbidity in the World Health Survey" />
    <meta property='og:url' content="TODO.com" />
    <meta property="og:type" content="website" />

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet">

    <!-- D3.JS -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

</head>

<body id="page-top">















<!-- =======================  LANDING SECTION ======================= -->
<header class="masthead">
 <div >
   <div class="container">
      <div class="intro-text">
        <br><br><br><br>
        <h1>Comorbidity in the World Health Survey</h1>
        <h6>What a 70 country wise study can teach us on comorbidity in mental disorders</h6>
        <center><img src="img/who_logo.jpg" width="200px"></img></center>
        <p>A work by Carmen <u>Lim</u>, Yan <u>Holtz</u>, John <u>McGrath</u> and others</p>
      </div>
    </div>
  </div>
  <div class="arrowlanding">
    <a class="js-scroll-trigger" href="#intro"><p style="font-size: 40px; color: black">&#xfe40;</p></a>
  </div>
</header>












<!-- =======================  PART 1 ======================= -->

<section id="part1">
  <div class="container">
    <div class="row">
      <div class="col-md-8" >
        <svg id="dataviz_worldmap" width="700" height="750"></svg>
      </div>
      <div class="col-md-4" style='padding-top: 80px'>
        <h3 style="line-height: 50px"><u>Part 1</u>:<br>What is the World Health Survey</h3>
        <hr>
        <p>The World Health Survey was implemented by WHO in 2002â€“2004 in partnership with 70 countries to generate information on the health of adult populations and health systems</p>
        <hr>
        <p>The total sample size in these cross-sectional studies includes over 300 000 individuals.</p>
        <hr>
        <p>How we sampled data</p>
      </div>
    </p>
  </div>
</section>


<!-- Load d3.js plugins -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>


<script>

// The svg
var svg1 = d3.select("#dataviz_worldmap"),
  width = +svg1.attr("width"),
  height = +svg1.attr("height");

// Map and projection
var path = d3.geoPath();
var projection = d3.geoNaturalEarth()
  .scale(width / 1.4 / Math.PI)
  .translate([width / 2, height / 2]);

// Data and color scale
var data = d3.map();
var colorScale = d3.scaleThreshold()
  .domain([100000, 1000000, 10000000, 30000000, 100000000, 500000000])
  .range(d3.schemeBlues[7]);

// Load external data and boot
d3.queue()
  .defer(d3.json, "https://raw.githubusercontent.com/holtzy/Como-in-World-Heath-Survey/master/DATA/world.geojson?token=AJx4QRu3RdqmZJMXWMjvBG8BZ2MOzy7Wks5bz9RZwA%3D%3D")
  .defer(d3.csv, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_population.csv", function(d) { data.set(d.code, +d.pop); })
  .await(ready);

function ready(error, topo) {
  if (error) throw error;

  // Draw the map
  svg1.append("g")
    .selectAll("path")
    .data(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      });
    }

</script>













<!-- =======================  PART 2 ======================= -->

<section id="part2" class="bg-light">
  <div class="container">

    <div class="row">
      <div class="col-md-7 mx-auto" style="text-align: center">
        <h3>Como is pervasive</h3>
        <hr>
        <p id=beeswarmText>First we could remember briefly what is comorbidity is, and what is a <u>Hazard Ratio</u></p>
        <button id="step1">Step1</button>
        <button id="step2">Step2</button>
        <button id="step3">Step3</button>
        <button id="step4">Step4</button>
      </div>
    </div>
    <div class="row">
      <div class="col-md-10 mx-auto">
        <svg id="dataviz2" width="960" height="400"></svg>
      </div>
    </div>
  </div>
</section>



<style>
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
.axis text {
  font: 10px sans-serif;
}
.cells path {
  fill: none;
  pointer-events: all;
}
.cells :hover circle {
  fill: red;
}
</style>

<script>

var svg2 = d3.select("#dataviz2"),
    margin = {top: 40, right: 40, bottom: 40, left: 40},
    width = svg2.attr("width") - margin.left - margin.right,
    height = svg2.attr("height") - margin.top - margin.bottom;

var formatValue = d3.format(".1f");

var x = d3.scaleLog()
    .rangeRound([0, width]);

var g = svg2.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("https://raw.githubusercontent.com/holtzy/Como-in-World-Heath-Survey/master/DATA/data.csv?token=AJx4QeYkATygWA2ROlBzjDr-iUEscLZTks5b197IwA%3D%3D", type, function(error, data) {

  if (error) throw error;

  x.domain(d3.extent(data, function(d) { return d.HR; }));

  var simulation = d3.forceSimulation(data)
      .force("x", d3.forceX(function(d) { return x(d.HR); }).strength(1))
      .force("y", d3.forceY(height / 2))
      .force("collide", d3.forceCollide(7))
      .stop();

  for (var i = 0; i < 150; ++i) simulation.tick();

  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).ticks(15, ".0s"));

  var cell = g.append("g")
      .attr("class", "cells")
    .selectAll("g").data(d3.voronoi()
        .extent([[-margin.left, -margin.top], [width + margin.right, height + margin.top]])
        .x(function(d) { return d.x; })
        .y(function(d) { return d.y; })
      .polygons(data)).enter().append("g");

  cell.append("circle")
      .attr("r", 5)
      .attr("cx", function(d) { return d.data.x; })
      .attr("cy", height)
      .style("stroke", "transparent")
      .style("fill", "transparent")

  cell.append("path")
      .attr("d", function(d) { return "M" + d.join("L") + "Z"; });

  cell.append("title")
      .text(function(d) { return "Prior disorder: "+ d.data.Prior_disorder + "\n" + "Later disorder: "+ d.data.Later_disorder + "\n" + "Hazard ratio: " + formatValue(d.data.HR); });



  // ----- STEP 1 : SHOW HR = 1 ------
  d3.select("#step1").on("click", function(){
    // Change text
    d3.select("#beeswarmText")
      .transition()
      .duration(1000)
      .text("If two disorders are not related, we expect to observe a hazard ratio close to one. If the Hazard ratio is over 1, it means that having a first disorder increases chances to get the second disorder.")
    // Add abline at HR = 1 but with no height
    cell
      .append("line")
      .attr("x1", x(1))
      .attr("x2", x(1))
      .attr("y1", height)
      .attr("y2", height)
      .style("stroke", "red")

    cell
      .selectAll("line")
      .transition()
      .duration(5000)
      .attr("y1", 0)

  })

  // ----- STEP 2 : SHOW ALL POINTS ------
  d3.select("#step2").on("click", function(){
    // Change text
    d3.select("#beeswarmText")
      .transition()
      .duration(1000)
      .text("We've studied the relationship between 500 pairs of diseases and estimated their hazard ratio. We found that 98% of them are significantly over 1. Comorbidity is pervasive: having a mental disorder almost always increase patient probability to develop another one.")
    // circles appear
    cell.selectAll("circle")
      .transition()
      .duration(3000)
      .attr("cy", function(d) { return d.data.y; })
      .style("stroke", "black")
      .style("fill", "#69b3a2")
      .style("opacity", "0.5")
  })


  // ----- STEP 3 : HIGHLIGHT HIGH VALUES ------
  d3.select("#step3").on("click", function(){
    // Change text
    d3.select("#beeswarmText")
      .transition()
      .duration(1000)
      .text("It is interesting to notice that some pairs have incredibly high hazard ratios. For instance, Bulimia and Binge eating disorder are almost always observed together.")

    cell.selectAll("circle")
      .transition()
      .duration(3000)
      .attr("r", function(d) { if (d.data.HR > 20) {return 13} else { return 5 } })
      .style("stroke", "black")
      .style("fill", function(d) { if (d.data.HR > 20) {return "red"} else { return "grey" } })
      .style("opacity", function(d) { if (d.data.HR > 20) {return 0.8} else { return 0.2 } })
  })


  // ----- STEP 4 : HIGHLIGHT LOW VALUES ------
  d3.select("#step4").on("click", function(){
    // Change text
    d3.select("#beeswarmText")
      .transition()
      .duration(1000)
      .text("Only 3 pairs of disorder present hazard ratio equal or lower to 1. For instance, major depressive disorder and child separation anxiety disorder have a HR of 0.8.")

    cell.selectAll("circle")
      .transition()
      .duration(3000)
      .attr("r", function(d) { if (d.data.HR <= 1) {return 13} else { return 5 } })
      .style("stroke", "black")
      .style("fill", function(d) { if (d.data.HR <= 1) {return "green"} else { return "grey" } })
      .style("opacity", function(d) { if (d.data.HR <= 1) {return 0.8} else { return 0.2 } })
  })

});

function type(d) {
  if (!d.HR) return;
  d.HR = +d.HR;
  return d;
}



</script>















<!-- =======================  PART 3 ======================= -->

<section id="part2" class="bg" style="padding-top: 50px; padding-bottom: 250px">
  <div class="container">

    <div class="row">
      <div class="col-md-7" id="dataviz2">-</div>
      <div class="col-md-5" style="padding-top: 200px">
        <h3 style="line-height: 50px"><u>Part 3</u>:<br>Links</h3>
        <hr>
        <p>What link to what</p>
        <hr>
        <p>Kind of sankey diagram but disorder are organized by group. And collapsible. Arc instead of straight. Lot of transparency to be able to highlight a group.</p>
        <hr>
        <p></p>
      </div>
  </div>
</section>


















<!-- =======================  PART 3 ======================= -->

<section id="part2" class="bg-light" style="padding-top: 50px; padding-bottom: 250px">
  <div class="container">

    <div class="row">
      <div class="col-md-5" style="padding-top: 200px">
        <h3 style="line-height: 50px"><u>Part 4</u>:<br>Symetry</h3>
        <hr>
        <p>Could do with a circular layout?</p>
        <hr>
        <p>One more layer on the barplot</p>
        <hr>
        <p><u>Data</u>: Ben Neales Lab from LD score regression?</p>
      </div>
      <div class="col-md-7" id="dataviz2">-</div>
  </div>
</section>







<!-- ======================= LOGO SECTION =============================== -->



  <section id="contact"  style="padding-top: 4%; padding-bottom: 4%; background-color: white">
     <div class="container">
       <div class="row">
         <div class="col-lg-4 text-center" style="margin-top: 40px; margin-bottom: 40px;">
          <br>
          <a href="http://www.au.dk/en/"><img class="img-fluid d-block mx-auto" src="img/aarhus_university_logo.png" alt=""></a>
         </div>
         <div class="col-lg-4 text-center">
           <a href="https://dg.dk/en/"><img class="img-fluid d-block mx-auto" src="img/DNRF.png" alt=""></a>
         </div>
         <div class="col-lg-4 text-center"s tyle="margin-top: 40px; margin-bottom: 40px;">
          <br>
          <a href="https://www.uq.edu.au"><img class="img-fluid d-block mx-auto" src="img/UQlogo.png" alt=""></a>
         </div>
         <div class="col-lg-4 offset-lg-2 text-center" style="margin-top: 40px; margin-bottom: 40px;">
          <br>
          <a href="http://econ.au.dk/the-national-centre-for-register-based-research/niels-bohr-professorship/"><img class="img-fluid d-block mx-auto" src="img/NBPlogo.jpg" alt="" style="width: 60%"></a>
         </div>
         <div class="col-lg-4 text-center" style="margin-top: 40px; margin-bottom: 40px;">
          <br>
          <a href="https://www.harvard.edu"><img class="img-fluid d-block mx-auto" src="img/harvard.png" alt="" style="width: 80%"></a>
         </div>
        </div>
       </div>
    </div>
  </section>







<!-- ======================= FOOTER SECTION ================================ -->
    <footer class="bg-light">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="copyright">Copyright &copy; The <a href="https://www.nbepi.com">Como project</a> 2018</span>
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/R_Graph_Gallery">
                  <i class="fa fa-twitter"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/holtzy">
                  <i class="fa fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                  <i class="fa fa-linkedin"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a href="#">Privacy Policy</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

<!-- ======================================================================= -->













<!-- =================== MODAL SECTION ===================================== -->

    <!-- Poster FULL -->
    <div class="portfolio-modal modal fade" id="greentech" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog h-100" style="max-width: 100vw;">
        <div class="modal-content">
          <div class="close-modal" data-dismiss="modal">
            <div class="lr">
              <div class="rl"></div>
            </div>
          </div>
          <div class="container">
            <div class="row">
                <div class="modal-body">
                  <!-- Project Details Go Here -->
                   <p style="display:inline; font-size: 35px; margin-top: 60px">The GreenTech Challenge</p>
                      <hr style="width: 100px; height: 1px; border:none;color:#333;background-color:#333;">
                      <br>
                      <ul class="list-inline social-buttons">
                        <li class="list-inline-item">
                          <a href="https://twitter.com/R_Graph_Gallery">
                            <i class="fa fa-twitter"></i>
                          </a>
                        </li>
                        <li class="list-inline-item social-buttons">
                          <a href="https://github.com/holtzy">
                            <i class="fa fa-github" style="color: white"></i>
                          </a>
                        </li>
                        <li class="list-inline-item social-buttons">
                          <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                            <i class="fa fa-linkedin"></i>
                          </a>
                        </li>
                      </ul>
                      <br><br>
                      <p>Yan Holtz's <u>blog</u> on statistics, R and Dataviz. More or less linked with our world, always related to data.</p>
                      <h1>Something</h1>
                      <hr>
                      <p>blaaaaa</p>

                </div>
            </div>
          </div>
        </div>
      </div>
    </div>




    <!-- Violin -->
    <div class="portfolio-modal modal fade" id="violin" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="close-modal" data-dismiss="modal">
            <div class="lr">
              <div class="rl"></div>
            </div>
          </div>
          <div class="container">
            <div class="row">
              <div class="col-lg-10 mx-auto">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
<!-- ======================================================================= -->











<!-- ======================== JAVASCRIPT SECTION =========================== -->



    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Contact form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>
    <script src="js/portfolio.js"></script>
    <script src="js/tree.js"></script>

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.min.js"></script>









<!-- ======================================================================= -->
  </body>

</html>
