<!DOCTYPE html>


<head>

    <meta charset="utf-8">
    <title>Comorbidity in the World Health Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Comorbidity in the World Health Survey">
    <meta name="keywords" content="Mental, Disorders, Schizophrenia">
    <meta name="author" content="Yan Holtz et al.">

    <!-- Control appearance when share by social media -->
    <meta property="og:title" content="Comorbidity in the World Health Survey" />
    <meta property="og:image" content="img/TODO" />
    <meta property="og:description" content="Comorbidity in the World Health Survey" />
    <meta property='og:url' content="TODO.com" />
    <meta property="og:type" content="website" />

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet">

    <!-- D3.JS -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!-- Load d3.js plugins -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

</head>

<body id="page-top">






<!-- =======================  MENU AND SIDE ARROW ======================= -->


<nav class="navbar navbar-expand-lg fixed-top" id="mainNav">
  <div class="container">
    <a href="index.html">&larr; Home</a>
  </div>
</nav>

<a class="btn btn-primary leftLink" href="heatmap.html">&#x2039; Heatmap</a>
<a class="btn btn-primary rightLink" href="">Next &#x203A;</a>

















<!-- =======================  SECTION BARPLOT ======================= -->

<section id="symetry" class="bg">

  <div class="row" style="padding-top: 0px; margin-top: 0px">
    <div class="col-md-12">
      <center><div id="dataviz_histo"></div></center>
    </div>
  </div>



  <div class="container" style="position: relative;">

    <a href="beeswarm.html" class="left_arrow"><span class="left"></span></a>
    <a href="heatmap.html" class="right_arrow"><span class="right"></span></a>

    <div class="row">
      <div class="col-md-3 my-auto">
        <h3>Symmetrical and Asymmetrical patterns</h3>
        <hr>
        <p>In these graphs, we wish to explore the <u>bidirectional association</u> between pairs of disorders.</p>
        <p>The results suggest that most temporally ordered disorder pairs have a bidirectional relationship - there is an increased risk of disorder regardless of temporal order.</p>
        <p>However, some disorder pairs appeared to be quite symmetrical – we call these ‘mirror phenotypes’ – where it seems the risk of developing either disorder are similar regardless of which disorder comes first.</p>
      </div>
      <div class="col-md-9">
        <center><div id="dropdown"></div></center>
        <div id="dataviz_barplot"></div>
      </div>
  </div>
</section>



<style>
.lineHisto:hover {
  opacity: 1;
}
</style>


<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<script>

// set the dimensions and margins of the graph
var margin = {top: 80, right: 0, bottom: 50, left: 0},
  propMiddle = 0.27,  // proportion of the width for the text in the middle
  width = 800 - margin.left - margin.right,
  height = 700 - margin.top - margin.bottom,
  lengthMiddle = width * propMiddle

// append the svg object to the body of the page
var svg_barplot = d3.select("#dataviz_barplot")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// LONG HISTO -> set the dimensions and margins of the graph
var marginHisto = {top: 0, right: 0, bottom: 0, left: 0},
  widthHisto = 2000 - marginHisto.left - marginHisto.right,
  heightHisto = 170 - marginHisto.top - marginHisto.bottom

// LONG HISTO -> append the svg object to the body of the page
var svg_histo = d3.select("#dataviz_histo")
  .append("svg")
    .attr("width", widthHisto + marginHisto.left + marginHisto.right)
    .attr("height", heightHisto + marginHisto.top + marginHisto.bottom)
  .append("g")
    .attr("transform",
          "translate(" + marginHisto.left + "," + marginHisto.top + ")")

// LONG HISTO -> Initialize the first X axis
var xHisto = d3.scaleLinear()
    .range([0, widthHisto])
    .domain([0,420]);

// LONG HISTO -> Y axis
var yHisto = d3.scaleLinear()
    .range([heightHisto/2, 0])
    .domain([0,13]);



//Read the data
d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/QBI/data.csv", function(data) {

  // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
  var myPrior = d3.map(data, function(d){return d.Prior_disorder;}).keys()
  var myLater = d3.map(data, function(d){return d.Later_disorder;}).keys()

  // Create a color palette for groups
  var col1 = "#482677FF", col2 = "#2D708EFF", col3 = "#29AF7FFF", col4 = "#B8DE29FF"
  var allDisorder =[ "Major depressive episode","Bipolar disorder","Dysthymia",
                "Panic disorder","Generalized anxiety disorder","Social phobia","Specific Phobia","Agoraphobia","PTSD","Obsessive compulsive disorder","Adult separation anxiety disorder","Child separation anxiety disorder",
                "Anorexia nervosa","Bulimia nervosa","Binge eating disorder","IED","ADHD","Conduct disorder","Oppositional defiant disorder",
                "Nicotine dependence","Alcohol abuse","Alcohol dependence","Drug abuse","Drug dependence"]
  var myColor = d3.scaleOrdinal()
    .domain(allDisorder)
    .range([col1, col1, col1,
            col2, col2, col2, col2, col2, col2, col2, col2, col2,
            col3, col3, col3, col3, col3, col3, col3,
            col4, col4, col4, col4, col4]);

  // Create the dropdown button with all possibilities
  // var select = d3.select("#dropdown")
  //     .append('select')
  //     .attr('id','dropdown-disorder')
  //     .selectAll('option')
  // 	  .data(myPrior).enter()
  // 	  .append('option')
  //     .text(function (d) { return d; })
  //     .attr("value", function (d) { return d; });


  // LONG HISTO -> DRAW BARS
  svg_histo
    .selectAll("barHisto")
    .data(data.sort(function(a,b){
      if(a.Prior_disorder == b.Prior_disorder){
        return d3.descending(a.Later_disorder, b.Later_disorder)
      }
      return d3.descending(a.Prior_disorder, b.Prior_disorder)
    }))
    .enter()
    .append("line")
      .attr("class", "lineHisto")
      .style("stroke-width", 4)
      .attr("x1", function(d,i){ return xHisto(i) })
      .attr("x2", function(d,i){ return xHisto(i) })
      .attr("y1", yHisto(4) )
      .attr("y2", function(d){ return yHisto(d.HR) })
      .attr("stroke", function(d){ return myColor(d.Prior_disorder) })
      .attr("opacity", 0.3)
      .on("click", function(d,i){ update(d.Prior_disorder) } )

  // Initialize the first X axis
  var x1 = d3.scaleLinear()
      .range([0, width/2 - lengthMiddle/2])
  var x1Axis = svg_barplot.append("g")
      .attr("transform", "translate(0," + height + ")")

  // Initialize the second X axis
  var x2 = d3.scaleLinear()
      .range([width/2 + lengthMiddle/2, width ])
  var x2Axis = svg_barplot.append("g")
      .attr("transform", "translate(0," + height + ")")

  // Add axis labels
  x1Axis
    .append("text")
      .attr("x", 0)
      .attr("y", 40)
      .attr("fill", "#000")
      .attr("text-anchor", "start")
      .attr("font-weight", "bold")
      .text("Hazard ratio");
  x2Axis
    .append("text")
      .attr("x", width)
      .attr("y", 40)
      .attr("fill", "#000")
      .attr("text-anchor", "end")
      .attr("font-weight", "bold")
      .text("Hazard ratio");

  // Set range and domain for Y axis
  var y = d3.scaleBand()
      .domain(myPrior)
      .range([height, 0])
      .padding([0.13])

  // Draw disorder names in the middle
  var myText = svg_barplot.selectAll(".textMiddle")
    .data(myPrior)
    .enter()
    .append("text")
      .attr("x", width/2)
      .attr("y", function(d) { return( y(d)+y.bandwidth()/2 ) })
      .text(function(d){ return d })
      .attr("text-anchor", "middle")
      .style("font-size", "12px")
      .attr("dominant-baseline", "central")
      .on("click", function(d,i){ update(d) } )

  // Add the explanation in grey
  var myExplanationLeft = svg_barplot
    .append("text")
      .attr("x", width/2 - lengthMiddle/2 )
      .attr("y", -10)
      .text( "As a prior disorder" )
      .style("font-size", "12px")
      .attr("text-anchor", "end")
      .style("fill", "grey")
      .style("font-style", "italic")
  var myExplanationLeft = svg_barplot
    .append("text")
      .attr("x", width/2 + lengthMiddle/2 )
      .attr("y", -10)
      .text( "As a later disorder" )
      .style("font-size", "12px")
      .attr("text-anchor", "start")
      .style("fill", "grey")
      .style("font-style", "italic");

  // Add the title
  var myTitle = svg_barplot
    .append("text")
      .attr("x", width/2)
      .attr("y", -50)
      .style("font-size", "22px")
      .attr("text-anchor", "middle")


  // A function that create / update the plot for a given variable:
  function update(variable) {

    // get the data
    var don1 = data.filter(function(d){return d.Prior_disorder == variable;})
    var don2 = data.filter(function(d){return d.Later_disorder == variable;})

    // biggest HR?
    var a = d3.max(don1, function(d) { return +d.HR; })
    var b = d3.max(don2, function(d) { return +d.HR; })
    var HRmax = Math.max(a,b)

    // Update color of the text in the middle
    myText
      .transition()
      .duration(1000)
      .style("fill", function(d){ if(d==variable){ return "grey" } else { return myColor(d) } })
      .style("opacity", function(d){ if(d==variable){ return 0.1 } else { return 1 } })

    // Update title
    myTitle
      .transition()
      .duration(1000)
      .text(variable)

    // Update x1 axis
    x1.domain([HRmax, 0])
    x1Axis.transition().duration(1000).call(d3.axisBottom(x1).ticks(5))

    // Update x2 axis
    x2.domain([0, HRmax])
    x2Axis.transition().duration(1000).call(d3.axisBottom(x2).ticks(5))

    // Add bars graph left
    var u1 = svg_barplot.selectAll(".barleft")
      .data(don1)

    u1.enter()
      .append("rect")
      .attr("class", "barleft")
      .merge(u1)
      .transition()
      .duration(1000)
        .attr("x", function(d) { return x1(0) } )
        .attr("y", function(d) { return y(d.Later_disorder); })
        .attr("width", function(d) { return  0  })
        .attr("height", y.bandwidth())
        .attr("rx", 2)
        .attr("opacity", 0.7)
        .style("fill", function(d){ return myColor(d.Later_disorder) })
      .transition()
      .duration(1000)
        .attr("x", function(d) { return x1(d.HR) } )
        .attr("width", function(d) { return  x1(0) - x1(d.HR)  })


    u1.exit()
      .remove()

    //Add bars graph right
    var u2 = svg_barplot.selectAll(".barright")
      .data(don2)

    u2.enter()
      .append("rect")
      .attr("class", "barright")
      .merge(u2)
      .transition()
      .duration(1000)
        .attr("x", function(d) { return x2(0) } )
        .attr("y", function(d) { return y(d.Prior_disorder); })
        .attr("width", function(d) { return  0 })
        .attr("height", y.bandwidth())
        .attr("rx", 2)
        .attr("opacity", 0.7)
        .style("fill", function(d){ return myColor(d.Prior_disorder) })
      .transition()
      .duration(1000)
        .attr("width", function(d) { return  x2(d.HR)-x2(0)  })


    u2.exit()
      .remove()

  }

  // Initialize with Alcohol abuse
  update("Alcohol abuse")

  // Add a listener to the button for selection and run the update function if needed
  d3.select("#dropdown-disorder")
    .on("change",function(d){
      var selected = d3.select("#dropdown-disorder").node().value;
      update(selected)
  })

})


</script>













<!-- ======================= FOOTER SECTION ================================ -->
    <footer class="bg-light">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="copyright">Copyright &copy; The <a href="https://www.nbepi.com">Como project</a> 2018</span>
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a href="https://www.nbepi.com">
                  <i class="fa fa-home"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/holtzy">
                  <i class="fa fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                  <i class="fa fa-linkedin"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a href="#">Privacy Policy</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

<!-- ======================================================================= -->













<!-- =================== MODAL SECTION ===================================== -->

    <!-- Poster FULL -->
    <div class="portfolio-modal modal fade" id="greentech" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog h-100" style="max-width: 100vw;">
        <div class="modal-content">
          <div class="close-modal" data-dismiss="modal">
            <div class="lr">
              <div class="rl"></div>
            </div>
          </div>
          <div class="container">
            <div class="row">
                <div class="modal-body">
                  <!-- Project Details Go Here -->
                   <p style="display:inline; font-size: 35px; margin-top: 60px">The GreenTech Challenge</p>
                      <hr style="width: 100px; height: 1px; border:none;color:#333;background-color:#333;">
                      <br>
                      <ul class="list-inline social-buttons">
                        <li class="list-inline-item">
                          <a href="https://twitter.com/R_Graph_Gallery">
                            <i class="fa fa-twitter"></i>
                          </a>
                        </li>
                        <li class="list-inline-item social-buttons">
                          <a href="https://github.com/holtzy">
                            <i class="fa fa-github" style="color: white"></i>
                          </a>
                        </li>
                        <li class="list-inline-item social-buttons">
                          <a href="https://www.linkedin.com/in/yan-holtz-2477534a/">
                            <i class="fa fa-linkedin"></i>
                          </a>
                        </li>
                      </ul>
                      <br><br>
                      <p>Yan Holtz's <u>blog</u> on statistics, R and Dataviz. More or less linked with our world, always related to data.</p>
                      <h1>Something</h1>
                      <hr>
                      <p>blaaaaa</p>

                </div>
            </div>
          </div>
        </div>
      </div>
    </div>




    <!-- Violin -->
    <div class="portfolio-modal modal fade" id="violin" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="close-modal" data-dismiss="modal">
            <div class="lr">
              <div class="rl"></div>
            </div>
          </div>
          <div class="container">
            <div class="row">
              <div class="col-lg-10 mx-auto">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
<!-- ======================================================================= -->











<!-- ======================== JAVASCRIPT SECTION =========================== -->



    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Contact form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>
    <script src="js/portfolio.js"></script>
    <script src="js/tree.js"></script>

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.min.js"></script>









<!-- ======================================================================= -->
  </body>

</html>
